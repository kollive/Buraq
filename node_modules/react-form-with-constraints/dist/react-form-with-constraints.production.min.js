!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.ReactFormWithConstraints={},e.React,e.PropTypes)}(this,function(e,t,r){"use strict";function n(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]]);return r}function o(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(o(arguments[t]));return e}function a(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.validateEventEmitter=new f,t}return n(t,e),t.prototype.emitValidateEvent=function(e){this.validateEventEmitter.emit(c,e)},t.prototype.addValidateEventListener=function(e){this.validateEventEmitter.addListener(c,e)},t.prototype.removeValidateEventListener=function(e){this.validateEventEmitter.removeListener(c,e)},t}(e)}var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},d=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},f=function(){function e(){this.listeners=new Map}return e.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.listeners.get(e);void 0!==n&&(console.assert(n.length>0,"No listener for event '"+e+"'"),n.forEach(function(e){return e.apply(void 0,s(t))}))},e.prototype.addListener=function(e,t){this.listeners.has(e)||this.listeners.set(e,[]);var r=this.listeners.get(e);console.assert(-1===r.indexOf(t),"Listener already added for event '"+e+"'"),r.push(t)},e.prototype.removeListener=function(e,t){var r=this.listeners.get(e);console.assert(void 0!==r,"Unknown event '"+e+"'");var n=r.lastIndexOf(t);console.assert(n>-1,"Listener not found for event '"+e+"'"),r.splice(n,1),0===r.length&&this.listeners.delete(e)},e}(),c="VALIDATE_EVENT",p={dirty:!1,errors:new Set,warnings:new Set,infos:new Set,validationMessage:""};!function(e){e.Added="FIELD_ADDED",e.Removed="FIELD_REMOVED",e.Updated="FIELD_UPDATED"}(e.FieldEvent||(e.FieldEvent={}));var u=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=Object.create(null),e}return n(r,t),r.prototype.addField=function(t){if(void 0===this.fields[t]){var r=p;this.fields[t]=r,this.emit(e.FieldEvent.Added,t,r)}},r.prototype.removeField=function(t){console.assert(void 0!==this.fields[t],"Unknown field '"+t+"'"),delete this.fields[t],this.emit(e.FieldEvent.Removed,t)},r.prototype.cloneField=function(e){var t=this.fields[e];console.assert(void 0!==t,"Unknown field '"+e+"'");return{dirty:t.dirty,errors:new Set(t.errors),warnings:new Set(t.warnings),infos:new Set(t.infos),validationMessage:t.validationMessage}},r.prototype.updateField=function(t,r){console.assert(void 0!==this.fields[t],"Unknown field '"+t+"'"),this.fields[t]=r,this.emit(e.FieldEvent.Updated,t)},r.prototype.removeFieldFor=function(t,r){var n=this.fields[t];console.assert(void 0!==n,"Unknown field '"+t+"'");var i=function(e){return r!==Math.floor(e)};n.errors=new Set(Array.from(n.errors).filter(i)),n.warnings=new Set(Array.from(n.warnings).filter(i)),n.infos=new Set(Array.from(n.infos).filter(i)),this.emit(e.FieldEvent.Updated,t)},r.prototype.getFieldFor=function(e,t){var r=this.fields[e];console.assert(void 0!==r,"Unknown field '"+e+"'");var n=function(e){return t===Math.floor(e)};return{dirty:r.dirty,errors:new Set(Array.from(r.errors).filter(n)),warnings:new Set(Array.from(r.warnings).filter(n)),infos:new Set(Array.from(r.infos).filter(n)),validationMessage:r.validationMessage}},r.prototype.containErrors=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(t){var r=e.fields[t];return void 0!==r&&r.errors.size>0})},r.prototype.containWarnings=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(t){var r=e.fields[t];return void 0!==r&&r.warnings.size>0})},r.prototype.containInfos=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(t){var r=e.fields[t];return void 0!==r&&r.infos.size>0})},r.prototype.areValidDirtyWithoutWarnings=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.some(function(t){var r=e.fields[t];return void 0!==r&&!0===r.dirty&&0===r.errors.size&&0===r.warnings.size})},r}(f),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(t.Component),v=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.fieldsStore=new u,t.fieldFeedbacksKey=0,t}return n(o,e),o.prototype.getChildContext=function(){return{form:this}},o.prototype.computeFieldFeedbacksKey=function(){return this.fieldFeedbacksKey++},o.prototype.validateFields=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t.filter(function(e){return"string"!=typeof e}),i=t.filter(function(e){return"string"==typeof e}),o=[];if(0===t.length&&(o=this.form.querySelectorAll("[name]")),i.length>0){var a=i.map(function(e){return'[name="'+e+'"]'});o=this.form.querySelectorAll(a.join(", "))}s(n,o).forEach(function(t){return e.emitValidateEvent(t)})},o.prototype.isValid=function(){var e=Object.keys(this.fieldsStore.fields);return!(t=this.fieldsStore).containErrors.apply(t,s(e));var t},o.prototype.render=function(){var e=this,r=this.props,n=r.children,o=i(r,["children"]);return t.createElement("form",d({ref:function(t){return e.form=t}},o),n)},o.childContextTypes={form:r.object.isRequired},o}(a(h)),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(t.Component),m=function(o){function s(e,t){var r=o.call(this,e)||this;return r.fieldFeedbackKey=0,r.validate=r.validate.bind(r),r.reRender=r.reRender.bind(r),r.key=t.form.computeFieldFeedbacksKey(),r}return n(s,o),s.prototype.getChildContext=function(){return{fieldFeedbacks:this}},s.prototype.computeFieldFeedbackKey=function(){return this.key+this.fieldFeedbackKey++/10},s.prototype.componentWillMount=function(){var t=this.props.for;this.context.form.fieldsStore.addField(t),this.context.form.addValidateEventListener(this.validate),this.context.form.fieldsStore.addListener(e.FieldEvent.Updated,this.reRender)},s.prototype.componentWillUnmount=function(){var t=this.props.for;this.context.form.fieldsStore.removeField(t),this.context.form.removeValidateEventListener(this.validate),this.context.form.fieldsStore.removeListener(e.FieldEvent.Updated,this.reRender)},s.prototype.validate=function(e){var t=this.props.for;e.name===t&&(this.context.form.fieldsStore.removeFieldFor(t,this.key),this.emitValidateEvent(e))},s.prototype.reRender=function(e){this.props.for===e&&this.forceUpdate()},s.prototype.render=function(){var e=this.props,r=(e.for,e.show,e.children),n=i(e,["for","show","children"]);return t.createElement("div",d({},n),r)},s.defaultProps={show:"first"},s.contextTypes={form:r.object.isRequired},s.childContextTypes={fieldFeedbacks:r.object.isRequired},s}(a(y)),F=function(e){function o(t,r){var n=e.call(this,t)||this;return n.validate=n.validate.bind(n),n.key=r.fieldFeedbacks.computeFieldFeedbackKey(),n}return n(o,e),o.prototype.componentWillMount=function(){this.context.fieldFeedbacks.addValidateEventListener(this.validate)},o.prototype.componentWillUnmount=function(){this.context.fieldFeedbacks.removeValidateEventListener(this.validate)},o.prototype.validate=function(e){var t=this.props,r=t.when,n=t.warning,i=t.info,o=this.context.fieldFeedbacks.props.for,s=!1;if("function"==typeof r){r(e.value)&&(s=!0)}else{if("string"!=typeof r)throw new TypeError("Invalid FieldFeedback 'when' type: "+typeof r);var a=e.validity;a.valid||("*"===r?s=!0:(a.badInput&&"badInput"===r||a.patternMismatch&&"patternMismatch"===r||a.rangeOverflow&&"rangeOverflow"===r||a.rangeUnderflow&&"rangeUnderflow"===r||a.stepMismatch&&"stepMismatch"===r||a.tooLong&&"tooLong"===r||a.tooShort&&"tooShort"===r||a.typeMismatch&&"typeMismatch"===r||a.valueMissing&&"valueMissing"===r)&&(s=!0))}var l=this.context.form.fieldsStore.cloneField(o);l.dirty=!0,l.validationMessage=e.validationMessage,s&&(n?l.warnings.add(this.key):i?l.infos.add(this.key):l.errors.add(this.key)),this.context.form.fieldsStore.updateField(o,l)},o.prototype.className=function(){var e,t=this.context.fieldFeedbacks.props,r=t.for,n=t.show,i=this.context.form.fieldsStore.getFieldFor(r,this.context.fieldFeedbacks.key),o=i.errors,s=i.warnings,a=i.infos,l=o.values().next().value,d=s.values().next().value;return o.has(this.key)&&("all"===n||"first"===n&&l===this.key)?e="error":s.has(this.key)&&0===o.size&&("all"===n||"first"===n&&d===this.key)?e="warning":a.has(this.key)&&(e="info"),e},o.prototype.render=function(){var e=this.props,r=(e.when,e.error,e.warning,e.info,e.className),n=e.children,o=i(e,["when","error","warning","info","className","children"]),s=this.context.fieldFeedbacks.props.for,a=this.context.form.fieldsStore.getFieldFor(s,this.context.fieldFeedbacks.key).validationMessage,l=this.className(),f=null;return void 0!==l&&(l=void 0!==r?r+" "+l:l,f=void 0!==n?n:a),null!==f?t.createElement("div",d({},o,{className:l}),f):null},o.contextTypes={form:r.object.isRequired,fieldFeedbacks:r.object.isRequired},o}(t.Component);e.fieldWithoutFeedback=p,e.FormWithConstraintsComponent=h,e.FormWithConstraints=v,e.FieldFeedbacksComponent=y,e.FieldFeedbacks=m,e.FieldFeedback=F,e.FieldsStore=u,e.EventEmitter=f,e.ValidateEvent=c,e.withValidateEventEmitter=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-form-with-constraints.production.min.js.map
